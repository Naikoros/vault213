<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide-react@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
import React, { useState, useEffect, useRef } from 'react';
import { Zap, Package, BookOpen, AlertTriangle, Trophy, Star, Gift, Volume2, VolumeX } from 'lucide-react';

const ITEMS = {
  rust_bolt: { id: 'rust_bolt', name: '–†–∂–∞–≤—ã–π –±–æ–ª—Ç', icon: 'üî©', level: 1, tier: 1, desc: '–ù–∞–π–¥–µ–Ω –≤ —Ç—É–∞–ª–µ—Ç–µ 3-–≥–æ —ç—Ç–∞–∂–∞', color: '#8B4513' },
  rad_dirt: { id: 'rad_dirt', name: '–†–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω–∞—è –≥—Ä—è–∑—å', icon: 'üí©', level: 1, tier: 1, desc: '–°–≤–µ—Ç–∏—Ç—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ!', color: '#00FF00' },
  dirty_water: { id: 'dirty_water', name: '–ú—É—Ç–Ω–∞—è –≤–æ–¥–∞', icon: 'üíß', level: 1, tier: 1, desc: '–ù–∞ –≤–∫—É—Å –∫–∞–∫ –Ω–æ—Å–æ–∫', color: '#4682B4' },
  scrap_metal: { id: 'scrap_metal', name: '–ú–µ—Ç–∞–ª–ª–æ–ª–æ–º', icon: 'ü™ô', level: 1, tier: 1, desc: '–ë—ã–≤—à–∞—è –∫–∞—Å—Ç—Ä—é–ª—è', color: '#A9A9A9' },
  chip: { id: 'chip', name: '–ß–∏–ø –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞', icon: 'üíæ', level: 1, tier: 2, mergeFrom: ['rust_bolt', 'rust_bolt', 'rust_bolt'], desc: '–ü–∞—Ö–Ω–µ—Ç 2077 –≥–æ–¥–æ–º', color: '#FFD700' },
  clean_water: { id: 'clean_water', name: '–û—á–∏—â–µ–Ω–Ω–∞—è –≤–æ–¥–∞', icon: 'üí¶', level: 1, tier: 2, mergeFrom: ['dirty_water', 'dirty_water', 'dirty_water'], desc: '–ü–æ—á—Ç–∏ –Ω–µ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω–∞', color: '#87CEEB' },
  isotope: { id: 'isotope', name: '–ò–∑–æ—Ç–æ–ø', icon: '‚ò¢Ô∏è', level: 1, tier: 2, mergeFrom: ['rad_dirt', 'rad_dirt', 'rad_dirt'], desc: '–ì—Ä–µ–µ—Ç —Ä—É–∫–∏ –∑–∏–º–æ–π', color: '#39FF14' },
  metal_parts: { id: 'metal_parts', name: '–ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏', icon: 'üîß', level: 1, tier: 2, mergeFrom: ['scrap_metal', 'scrap_metal', 'scrap_metal'], desc: '–ü–æ—á—Ç–∏ –Ω–æ–≤—ã–µ!', color: '#C0C0C0' },
  gear: { id: 'gear', name: '–®–µ—Å—Ç–µ—Ä–µ–Ω–∫–∞ –ì–≠–ö–∞', icon: '‚öôÔ∏è', level: 1, tier: 3, mergeFrom: ['chip', 'chip', 'chip'], desc: '–ò–∑ —Ä–æ–±–æ—Ç–∞!', color: '#FFA500' },
  filter: { id: 'filter', name: '–§–∏–ª—å—Ç—Ä –¥–ª—è –≤–æ–¥—ã', icon: 'üî¨', level: 1, tier: 3, mergeFrom: ['clean_water', 'clean_water', 'clean_water'], desc: '–£–±–∏—Ä–∞–µ—Ç 99% —Ä–∞–¥–∏–∞—Ü–∏–∏', color: '#00CED1' },
  battery: { id: 'battery', name: '–Ø–¥—Ä–æ –°–∏–Ω—Ç–µ–∑–∞', icon: 'üîã', level: 1, tier: 3, mergeFrom: ['isotope', 'isotope', 'isotope'], desc: '–ù–µ —Ç—Ä—è—Å—Ç–∏!', color: '#7FFF00' },
  mechanism: { id: 'mechanism', name: '–ú–µ—Ö–∞–Ω–∏–∑–º', icon: 'üõ†Ô∏è', level: 1, tier: 3, mergeFrom: ['metal_parts', 'metal_parts', 'metal_parts'], desc: '–ö—Ä—É—Ç–∏—Ç—Å—è, –≤–µ—Ä—Ç–∏—Ç—Å—è', color: '#B0B0B0' },
  rad_seeds: { id: 'rad_seeds', name: '–†–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ–º–µ–Ω–∞', icon: 'üå±', level: 2, tier: 1, desc: '–ù–∞–π–¥–µ–Ω—ã –≤ –≥—Ä—è–∑–∏', color: '#32CD32' },
  mutant_sprout: { id: 'mutant_sprout', name: '–ú—É—Ç–∏—Ä–æ–≤–∞–≤—à–∏–π —Ä–æ—Å—Ç–æ–∫', icon: 'üåø', level: 2, tier: 2, mergeFrom: ['rad_seeds', 'rad_seeds', 'rad_seeds'], desc: '–ö—É—Å–∞–µ—Ç—Å—è!', color: '#228B22' },
  lamp_shroom: { id: 'lamp_shroom', name: '–ì—Ä–∏–±-—Ñ–æ–Ω–∞—Ä—å', icon: 'üçÑ', level: 2, tier: 3, mergeFrom: ['mutant_sprout', 'mutant_sprout', 'mutant_sprout'], desc: '–û—Å–≤–µ—â–∞–µ—Ç –∏ –∫–æ—Ä–º–∏—Ç', color: '#FF69B4' },
  water_system: { id: 'water_system', name: '–°–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏', icon: 'üö∞', level: 3, tier: 4, mergeFrom: ['filter', 'filter', 'filter'], desc: '–í–æ–¥–∞ –ø–æ—á—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞', color: '#1E90FF' },
  generator: { id: 'generator', name: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä', icon: '‚ö°', level: 3, tier: 4, mergeFrom: ['battery', 'battery', 'battery'], desc: '–°–≤–µ—Ç–∞ —Ö–≤–∞—Ç–∏—Ç!', color: '#FFFF00' },
  robot: { id: 'robot', name: '–ü—Ä–æ—Ç–µ–∫—Ç—Ä–æ–Ω', icon: 'ü§ñ', level: 3, tier: 4, mergeFrom: ['gear', 'gear', 'gear'], desc: '–ó–∞—â–∏—â–∞–µ—Ç —É–±–µ–∂–∏—â–µ', color: '#FF4500' },
};

const HOLOTAPES = [
  { id: 1, title: '–î–µ–Ω—å 1: –ù–∞—á–∞–ª–æ', text: '–°–º–æ—Ç—Ä–∏—Ç–µ–ª—å: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –£–±–µ–∂–∏—â–µ 213! –ó–¥–µ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω–æ... –Ω–∞–≤–µ—Ä–Ω–æ–µ."', caps: 50 },
  { id: 2, title: '–î–µ–Ω—å 47: –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç', text: '–°–º–æ—Ç—Ä–∏—Ç–µ–ª—å: "–ó–∞–±—ã–ª —É–ø–æ–º—è–Ω—É—Ç—å - –º—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —É–±–µ–∂–∏—â–µ. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: –≤—ã–∂–∏–≤—É—Ç –ª–∏ –ª—é–¥–∏ –Ω–∞ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ö?"', caps: 75 },
  { id: 3, title: '–î–µ–Ω—å 156: –ú—É—Ç–∞—Ü–∏—è', text: '–î–æ–∫—Ç–æ—Ä: "–†–∞–¥–∏–∞—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç –ª–µ–≥–∫–∏–µ –º—É—Ç–∞—Ü–∏–∏. –£ –Ω–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –∑–µ—Ä–∫–∞–ª–∞."', caps: 100 },
  { id: 4, title: '–î–µ–Ω—å 389: –í–æ—Å—Å—Ç–∞–Ω–∏–µ', text: '–û—Ö—Ä–∞–Ω–Ω–∏–∫: "–ñ–∏—Ç–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –µ–¥—É. –û–±—ä—è—Å–Ω–∏–ª —á—Ç–æ –∫—Ä—ã—Å—ã - –¥–µ–ª–∏–∫–∞—Ç–µ—Å. –ü–æ–≤–µ—Ä–∏–ª–∏!"', caps: 125 },
  { id: 5, title: '–î–µ–Ω—å 666: –ù–∞—Ö–æ–¥–∫–∞', text: '–ò–Ω–∂–µ–Ω–µ—Ä: "–ù–∞—à–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª. –ü–∞—Ä–æ–ª—å - password123. Vault-Tec —ç–∫–æ–Ω–æ–º–∏–ª."', caps: 150 },
];

const EVENTS = [
  { id: 'raiders', name: '‚ò†Ô∏è –ù–∞–±–µ–≥ —Ä–µ–π–¥–µ—Ä–æ–≤!', desc: '–ë–∞–Ω–¥–∞ "–î—Ä—É–∂–µ–ª—é–±–Ω—ã—Ö –ø—Å–∏—Ö–æ–ø–∞—Ç–æ–≤" —Ç—Ä–µ–±—É–µ—Ç –¥–∞–Ω—å. –û–Ω–∏ –Ω–µ —Ç–∞–∫–∏–µ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ.', type: 'bad' },
  { id: 'caravan', name: 'üöö –¢–æ—Ä–≥–æ–≤—ã–π –∫–∞—Ä–∞–≤–∞–Ω', desc: '–¢–æ—Ä–≥–æ–≤–µ—Ü –ø—Ä–æ–¥–∞–µ—Ç "100% –Ω–µ —Ä–∞–¥–∏–æ–∞–∫—Ç–∏–≤–Ω—ã–µ" —Ç–æ–≤–∞—Ä—ã.', type: 'good' },
  { id: 'radiation', name: '‚ò¢Ô∏è –£—Ç–µ—á–∫–∞ —Ä–∞–¥–∏–∞—Ü–∏–∏', desc: '–ö—Ç–æ-—Ç–æ –æ—Å—Ç–∞–≤–∏–ª –¥–≤–µ—Ä—å –≤ —Ä–µ–∞–∫—Ç–æ—Ä –æ—Ç–∫—Ä—ã—Ç–æ–π. –°–Ω–æ–≤–∞.', type: 'neutral' },
  { id: 'holotape', name: 'üíæ –ì–æ–ª–æ–¥–∏—Å–∫ –Ω–∞–π–¥–µ–Ω!', desc: '–°—Ç–∞—Ä–∞—è –∑–∞–ø–∏—Å—å. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏?', type: 'story' },
  { id: 'doctor', name: '‚öïÔ∏è –í—Ä–∞—á –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–º–æ—â—å', desc: '–î–æ–∫—Ç–æ—Ä: "–ú–æ–≥—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã! –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –∏–∑ —á–µ–≥–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ."', type: 'good' },
];

const QUESTS = [
  { id: 'q1', name: '–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏', desc: '–°–æ–±–µ—Ä–∏ 10 –ø—Ä–µ–¥–º–µ—Ç–æ–≤', reward: 100, progress: 0, max: 10, completed: false },
  { id: 'q2', name: '–ú–∞—Å—Ç–µ—Ä –∫—Ä–∞—Ñ—Ç–∞', desc: '–û–±—ä–µ–¥–∏–Ω–∏ 5 —Ä–∞–∑', reward: 150, progress: 0, max: 5, completed: false },
  { id: 'q3', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', desc: '–°–æ–∑–¥–∞–π 3 –ø—Ä–µ–¥–º–µ—Ç–∞ tier 3', reward: 200, progress: 0, max: 3, completed: false },
];

const Particle = ({ x, y, color }) => (
  <div
    className="absolute w-1 h-1 rounded-full animate-ping"
    style={{
      left: `${x}%`,
      top: `${y}%`,
      backgroundColor: color,
      animationDuration: `${Math.random() * 2 + 1}s`,
    }}
  />
);

export default function Vault213() {
  const [ap, setAp] = useState(100);
  const [level, setLevel] = useState(1);
  const [exp, setExp] = useState(0);
  const [caps, setCaps] = useState(100);
  const [gems, setGems] = useState(0);
  const [inventory, setInventory] = useState([]);
  const [selectedId, setSelectedId] = useState(null);
  const [currentEvent, setCurrentEvent] = useState(null);
  const [message, setMessage] = useState(null);
  const [holotapesFound, setHolotapesFound] = useState([]);
  const [quests, setQuests] = useState(QUESTS);
  const [nextId, setNextId] = useState(1);
  const [showShop, setShowShop] = useState(false);
  const [showStory, setShowStory] = useState(false);
  const [totalCollected, setTotalCollected] = useState(0);
  const [totalMerges, setTotalMerges] = useState(0);
  const [tier3Created, setTier3Created] = useState([]);
  const [soundEnabled, setSoundEnabled] = useState(true);
  const [particles, setParticles] = useState([]);

  const gridSize = 5;
  const maxAp = 100;
  const expToLevel = level * 100;

  useEffect(() => {
    loadGame();
    const particleInterval = setInterval(() => {
      setParticles(prev => [
        ...prev.slice(-20),
        {
          id: Date.now(),
          x: Math.random() * 100,
          y: Math.random() * 100,
          color: ['#00FF00', '#FFFF00', '#FF6600'][Math.floor(Math.random() * 3)]
        }
      ]);
    }, 500);
    return () => clearInterval(particleInterval);
  }, []);

  useEffect(() => {
    const interval = setInterval(() => {
      saveGame();
    }, 30000);
    return () => clearInterval(interval);
  }, [ap, level, exp, caps, inventory, holotapesFound, quests, gems]);

  useEffect(() => {
    const interval = setInterval(() => {
      setAp(prev => Math.min(prev + 1, maxAp));
    }, 3000);
    return () => clearInterval(interval);
  }, []);

  useEffect(() => {
    const interval = setInterval(() => {
      if (Math.random() < 0.15 && !currentEvent && inventory.length > 0) {
        const event = EVENTS[Math.floor(Math.random() * EVENTS.length)];
        setCurrentEvent(event);
      }
    }, 25000);
    return () => clearInterval(interval);
  }, [currentEvent, inventory.length]);

  const saveGame = async () => {
    try {
      const data = { ap, level, exp, caps, gems, inventory, holotapesFound, quests, totalCollected, totalMerges, tier3Created, nextId };
      await window.storage.set('vault213_save', JSON.stringify(data));
    } catch (e) {
      console.log('Save error:', e);
    }
  };

  const loadGame = async () => {
    try {
      const result = await window.storage.get('vault213_save');
      if (result && result.value) {
        const data = JSON.parse(result.value);
        setAp(data.ap || 100);
        setLevel(data.level || 1);
        setExp(data.exp || 0);
        setCaps(data.caps || 100);
        setGems(data.gems || 0);
        setInventory(data.inventory || []);
        setHolotapesFound(data.holotapesFound || []);
        setQuests(data.quests || QUESTS);
        setTotalCollected(data.totalCollected || 0);
        setTotalMerges(data.totalMerges || 0);
        setTier3Created(data.tier3Created || []);
        setNextId(data.nextId || 1);
        showMessage('‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω!');
      }
    } catch (e) {
      console.log('New game');
    }
  };

  const playSound = (type) => {
    if (!soundEnabled) return;
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    const freq = { collect: 400, merge: 600, levelup: 800, error: 200 };
    osc.frequency.value = freq[type] || 400;
    gain.gain.setValueAtTime(0.2, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
    osc.start();
    osc.stop(ctx.currentTime + 0.2);
  };

  const showMessage = (text, duration = 2000) => {
    setMessage(text);
    setTimeout(() => setMessage(null), duration);
  };

  const updateQuest = (questId) => {
    setQuests(prev => prev.map(q => {
      if (q.id === questId && !q.completed) {
        const newProgress = q.progress + 1;
        if (newProgress >= q.max) {
          setCaps(c => c + q.reward);
          showMessage(`üéâ –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +${q.reward} –∫—Ä—ã—à–µ–∫!`, 3000);
          return { ...q, progress: q.max, completed: true };
        }
        return { ...q, progress: newProgress };
      }
      return q;
    }));
  };

  const spawnItem = (itemId) => {
    if (inventory.length >= gridSize * gridSize) {
      showMessage('‚ùå –ù–µ—Ç –º–µ—Å—Ç–∞!');
      playSound('error');
      return false;
    }
    for (let y = 0; y < gridSize; y++) {
      for (let x = 0; x < gridSize; x++) {
        if (!inventory.find(i => i.x === x && i.y === y)) {
          setInventory(prev => [...prev, { id: nextId, item: itemId, x, y }]);
          setNextId(prev => prev + 1);
          return true;
        }
      }
    }
    return false;
  };

  const collectResource = () => {
    if (ap < 10) {
      showMessage('‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–ª!');
      playSound('error');
      return;
    }
    const items = level >= 2 ? ['rust_bolt', 'rad_dirt', 'dirty_water', 'scrap_metal', 'rad_seeds'] : ['rust_bolt', 'rad_dirt', 'dirty_water', 'scrap_metal'];
    const item = items[Math.floor(Math.random() * items.length)];
    if (spawnItem(item)) {
      setAp(prev => prev - 10);
      setTotalCollected(prev => prev + 1);
      updateQuest('q1');
      showMessage(`‚úÖ ${ITEMS[item].name}`);
      playSound('collect');
    }
  };

  const tryMerge = (i1, i2, i3) => {
    if (i1.item !== i2.item || i2.item !== i3.item) return false;
    const result = Object.values(ITEMS).find(i => i.mergeFrom && JSON.stringify(i.mergeFrom) === JSON.stringify([i1.item, i1.item, i1.item]));
    if (!result) return false;
    if (result.level > level) {
      showMessage(`üîí –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å ${result.level}`);
      playSound('error');
      return false;
    }
    setInventory(prev => prev.filter(i => i.id !== i1.id && i.id !== i2.id && i.id !== i3.id));
    setTimeout(() => {
      setInventory(prev => [...prev, { id: nextId, item: result.id, x: i1.x, y: i1.y }]);
      setNextId(prev => prev + 1);
      setTotalMerges(prev => prev + 1);
      updateQuest('q2');
      if (result.tier === 3 && !tier3Created.includes(result.id)) {
        setTier3Created(prev => [...prev, result.id]);
        updateQuest('q3');
      }
      setExp(prev => {
        const newExp = prev + 20;
        if (newExp >= expToLevel) {
          setLevel(l => l + 1);
          showMessage(`üéâ –£–†–û–í–ï–ù–¨ ${level + 1}!`, 3000);
          playSound('levelup');
          return newExp - expToLevel;
        }
        return newExp;
      });
      showMessage(`‚ú® ${result.name}!`);
      playSound('merge');
    }, 100);
    return true;
  };

  const handleCellClick = (x, y) => {
    const clicked = inventory.find(i => i.x === x && i.y === y);
    if (!clicked) {
      if (selectedId) setSelectedId(null);
      return;
    }
    if (!selectedId) {
      setSelectedId(clicked.id);
      return;
    }
    const selected = inventory.find(i => i.id === selectedId);
    if (selected.item === clicked.item) {
      const same = inventory.filter(i => i.item === selected.item);
      if (same.length >= 3) {
        if (tryMerge(same[0], same[1], same[2])) {
          setSelectedId(null);
          setAp(prev => Math.max(0, prev - 5));
          return;
        }
      }
    }
    setInventory(prev => prev.map(i => i.id === selectedId ? { ...i, x, y } : i));
    setSelectedId(null);
  };

  const handleEvent = (accept) => {
    if (!currentEvent) return;
    if (currentEvent.id === 'raiders' && accept) {
      const remove = inventory.slice(0, 3).map(i => i.id);
      setInventory(prev => prev.filter(i => !remove.includes(i.id)));
      setCaps(prev => prev + 50);
      showMessage('üíÄ –†–µ–π–¥–µ—Ä—ã —É—à–ª–∏');
    } else if (currentEvent.id === 'caravan' && accept && caps >= 100) {
      setCaps(prev => prev - 100);
      spawnItem('isotope');
      showMessage('üéÅ –ò–∑–æ—Ç–æ–ø!');
    } else if (currentEvent.id === 'holotape') {
      const idx = holotapesFound.length;
      if (idx < HOLOTAPES.length) {
        const tape = HOLOTAPES[idx];
        setHolotapesFound(prev => [...prev, tape.id]);
        setCaps(prev => prev + tape.caps);
        showMessage(tape.title, 3000);
      }
    } else if (currentEvent.id === 'doctor' && accept && caps >= 50) {
      setCaps(prev => prev - 50);
      setAp(prev => Math.min(prev + 50, maxAp));
      showMessage('üíä –í—ã–ª–µ—á–µ–Ω!');
    }
    setCurrentEvent(null);
  };

  return (
    <div className="min-h-screen relative overflow-hidden" style={{
      background: 'linear-gradient(135deg, #0a0e27 0%, #1a1f3a 25%, #2d1b00 50%, #1a0f00 75%, #000000 100%)'
    }}>
      {/* Animated particles */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        {particles.map(p => <Particle key={p.id} x={p.x} y={p.y} color={p.color} />)}
      </div>

      {/* Scanlines effect */}
      <div className="absolute inset-0 pointer-events-none opacity-10" style={{
        backgroundImage: 'repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,0,0.3) 2px, rgba(0,255,0,0.3) 4px)'
      }} />

      <div className="relative z-10 p-4">
        {/* Header with glass effect */}
        <div className="max-w-4xl mx-auto mb-6">
          <div className="relative overflow-hidden rounded-2xl p-6 backdrop-blur-xl border-2 shadow-2xl" style={{
            background: 'linear-gradient(135deg, rgba(255,165,0,0.2) 0%, rgba(255,69,0,0.3) 100%)',
            borderColor: '#FF8C00',
            boxShadow: '0 0 40px rgba(255,140,0,0.4), inset 0 0 20px rgba(255,165,0,0.1)'
          }}>
            <div className="absolute inset-0 opacity-20" style={{
              backgroundImage: 'radial-gradient(circle at 20% 50%, rgba(255,255,0,0.3) 0%, transparent 50%)'
            }} />
            
            <div className="relative">
              <h1 className="text-4xl font-bold text-center mb-2 tracking-widest" style={{
                fontFamily: 'monospace',
                textShadow: '0 0 20px rgba(255,165,0,0.8), 0 0 40px rgba(255,69,0,0.6)',
                background: 'linear-gradient(to right, #FFD700, #FF8C00, #FFD700)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                animation: 'pulse 2s ease-in-out infinite'
              }}>
                ‚öôÔ∏è –£–ë–ï–ñ–ò–©–ï 213 ‚öôÔ∏è
              </h1>
              <p className="text-center text-sm text-amber-200 mb-4 italic opacity-90">
                "–û—Å—Ç–∞–≤—å –Ω–∞–¥–µ–∂–¥—É –Ω–∞ –≤—ã—Ö–æ–¥, –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å!"
              </p>
              
              <div className="grid grid-cols-4 gap-3">
                {[
                  { label: '‚ö° –°–∏–ª—ã', value: `${ap}/${maxAp}`, color: 'from-green-500 to-emerald-600', glow: 'rgba(34,197,94,0.3)' },
                  { label: 'üèÜ –£—Ä–æ–≤–µ–Ω—å', value: level, color: 'from-blue-500 to-cyan-600', glow: 'rgba(59,130,246,0.3)' },
                  { label: 'üí∞ –ö—Ä—ã—à–∫–∏', value: caps, color: 'from-yellow-500 to-orange-600', glow: 'rgba(234,179,8,0.3)' },
                  { label: 'üíé –ñ–µ—Ç–æ–Ω—ã', value: gems, color: 'from-purple-500 to-pink-600', glow: 'rgba(168,85,247,0.3)' }
                ].map((stat, idx) => (
                  <div key={idx} className="relative p-3 rounded-xl backdrop-blur-sm border transition-all hover:scale-105" style={{
                    background: 'rgba(0,0,0,0.5)',
                    borderColor: 'rgba(255,255,255,0.2)',
                    boxShadow: `0 4px 20px ${stat.glow}`
                  }}>
                    <div className="text-xs text-amber-300 mb-1 font-semibold">{stat.label}</div>
                    <div className={`text-lg font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}>
                      {stat.value}
                    </div>
                  </div>
                ))}
              </div>

              <div className="mt-4 relative rounded-full h-4 overflow-hidden backdrop-blur-sm border" style={{
                background: 'rgba(0,0,0,0.6)',
                borderColor: 'rgba(255,255,255,0.2)'
              }}>
                <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse" />
                <div 
                  className="h-full bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 transition-all duration-1000 relative overflow-hidden"
                  style={{ width: `${(exp / expToLevel) * 100}%` }}
                >
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-shimmer" />
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Floating message */}
        {message && (
          <div className="fixed top-24 left-1/2 transform -translate-x-1/2 z-50 animate-bounce">
            <div className="px-6 py-4 rounded-xl font-bold text-lg backdrop-blur-xl border-2 shadow-2xl" style={{
              background: 'linear-gradient(135deg, rgba(255,165,0,0.9), rgba(255,69,0,0.9))',
              borderColor: '#FFD700',
              boxShadow: '0 0 30px rgba(255,215,0,0.6)',
              color: '#000'
            }}>
              {message}
            </div>
          </div>
        )}

        {/* Event modal with premium design */}
        {currentEvent && (
          <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn">
            <div className="relative max-w-md w-full">
              <div className="absolute inset-0 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl blur-xl opacity-50 animate-pulse" />
              <div className="relative p-6 rounded-2xl backdrop-blur-xl border-2" style={{
                background: 'linear-gradient(135deg, rgba(30,30,30,0.95), rgba(50,20,10,0.95))',
                borderColor: '#FF4500',
                boxShadow: '0 0 50px rgba(255,69,0,0.5)'
              }}>
                <h3 className="text-3xl font-bold mb-4 bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                  {currentEvent.name}
                </h3>
                <p className="text-amber-100 mb-6 text-lg">{currentEvent.desc}</p>
                <div className="flex gap-3">
                  <button onClick={() => handleEvent(true)} className="flex-1 py-4 rounded-xl font-bold text-lg transition-all hover:scale-105" style={{
                    background: 'linear-gradient(135deg, #10b981, #059669)',
                    boxShadow: '0 4px 20px rgba(16,185,129,0.4)'
                  }}>
                    ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                  </button>
                  <button onClick={() => handleEvent(false)} className="flex-1 py-4 rounded-xl font-bold text-lg transition-all hover:scale-105" style={{
                    background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                    boxShadow: '0 4px 20px rgba(239,68,68,0.4)'
                  }}>
                    ‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Main content */}
        <div className="max-w-4xl mx-auto">
          {/* Action buttons */}
          <div className="flex gap-3 mb-6">
            {[
              { icon: <BookOpen className="w-5 h-5" />, text: `–ò—Å—Ç–æ—Ä–∏—è (${holotapesFound.length}/5)`, onClick: () => setShowStory(true), color: 'from-amber-600 to-orange-700' },
              { icon: <Gift className="w-5 h-5" />, text: '–ú–∞–≥–∞–∑–∏–Ω', onClick: () => setShowShop(true), color: 'from-purple-600 to-pink-700' },
              { icon: soundEnabled ? <Volume2 className="w-5 h-5" /> : <VolumeX className="w-5 h-5" />, onClick: () => setSoundEnabled(!soundEnabled), color: 'from-stone-600 to-stone-700', iconOnly: true }
  </script>
</body>
</html>